{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}"/>
    <script defer src="{% static 'js/scripts.js' %}"></script>
    <title>Checkers</title>
</head>
<body>
    <div id='loadingMenu' style="visibility: hidden;">
        Waiting for opponent...<br>
        Room Code : {{ room_code }}<br>
    </div>
    <main id='main' style="visibility: visible;">
        <div class="red-turn-text mobile">
            Reds turn
        </div>
        <table>
            <tr>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="0"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="1"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="2"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="3"></p></td>
            </tr>
            <tr>
                <td><p class="red-piece" id="4"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="5"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="6"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="7"></p></td>
                <td class="noPieceHere"></td>
            </tr>
            <tr>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="8"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="9"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="10"></p></td>
                <td class="noPieceHere"></td>
                <td><p class="red-piece" id="11"></p></td>
            </tr>
            <tr>
                <td></td>
                <td class="noPieceHere"></td>
                <td></td>
                <td class="noPieceHere"></td>
                <td></td>
                <td class="noPieceHere"></td>
                <td></td>
                <td class="noPieceHere"></td>
            </tr>
            <tr>
                <td class="noPieceHere"></td>
                <td></td>
                <td class="noPieceHere"></td>
                <td></td>
                <td class="noPieceHere"></td>
                <td></td>
                <td class="noPieceHere"></td>
                <td></td>
            </tr>
            <tr>
                <td><span class="black-piece" id="12"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="13"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="14"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="15"></span></td>
                <td class="noPieceHere"></td>
            </tr>
            <tr>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="16"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="17"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="18"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="19"></span></td>
            </tr>
            <tr>
                <td><span class="black-piece" id="20"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="21"></span></td>
                <td class="noPieceHere">
                <td><span class="black-piece" id="22"></span></td>
                <td class="noPieceHere"></td>
                <td><span class="black-piece" id="23"></span></td>
                <td class="noPieceHere"></td>
            </tr>
        </table>
        <div class="desktop">
            <div class="red-turn-text">
                Reds turn 
                {% if player == "game_creator" %}
                    (YOU)
                {% endif %}
            </div>
            <p id="divider">|</p>
            <div class="black-turn-text">
                Blacks turn
                {% if player == "game_opponent" %}
                    (YOU)
                {% endif %}
            </div>
        </div>
        <div class="black-turn-text mobile">
            Blacks turn
        </div>
        <div class="options">
            <button onclick="gameDraw()">End game</button>
            <button id="start">
                Start Recording
            </button>
            <button id="stop" disabled>
                Stop Recording
            </button>
        </div>
    </main>
    {% if turn %}
    <script>
        let turn = true;
    </script>
    {% else %}
    <script>
        let turn = false;
    </script>
    {% endif %}

    <script>
        const room_code = '{{ room_code }}';
        const player = '{{ player }}';
        let redScore = {{ redScore|safe }};
        let blackScore = {{ blackScore|safe }};
        const game_squares = {{ game_squares|safe }};
    </script>
    <video  width="320" height="240" autoplay />
 <script>
      const start = document.getElementById("start");
const stop = document.getElementById("stop");
const video = document.querySelector("video");
let recorder, stream;

async function startRecording() {
  stream = await navigator.mediaDevices.getDisplayMedia({
    video: { mediaSource: "screen" }
  });
  recorder = new MediaRecorder(stream);

  const chunks = [];
  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = e => {
    const completeBlob = new Blob(chunks, { type: chunks[0].type });
    video.src = URL.createObjectURL(completeBlob);
  };

  recorder.start();
}

start.addEventListener("click", () => {
  start.setAttribute("disabled", true);
  stop.removeAttribute("disabled");

  startRecording();
});

stop.addEventListener("click", () => {
  stop.setAttribute("disabled", true);
  start.removeAttribute("disabled");

  recorder.stop();
  stream.getVideoTracks()[0].stop();
});  
    </script>


</body>
</html>